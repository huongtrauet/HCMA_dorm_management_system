<div class="student_management_list">
  <div class="header" style="display: flex; justify-content: space-between;">
    <div class="header_title">
      <h3>Student Management: </h3>
    </div>
    <div class="header_search">
      <button class="ui icon button" onclick="addStudent()">
        <i class="plus icon"></i>
      </button>
      <div class="ui icon input">
        <input type="text" placeholder="Search...">
        <i class="icon">
          <img src="/assets/search.png" style="width: 1rem; height: 1rem; width: 1rem; top: 50%; position: absolute; transform: translateY(-50%);right: 0.7rem;">
        </i> 
      </div>
    </div>
  </div>
  <div class="footer_line" style="height: 1px; background-color: rgba(34,36,38,.15); margin-top: 0.5rem; margin-bottom: 1.5rem"></div>
  <table class="ui very basic selectable table">
    <thead>
      <tr>
        <th>STT</th>
        <th>MSSV</th>
        <th>HO VA TEN</th>
        <th>NGAY SINH</th>
        <th>LOP</th>
        <th>QUE QUAN</th>
        <th>NGAY VAO</th>
        <th>ACTIVE</th>
      </tr>
    </thead>
    <tbody id="student_list"> 
      <% @students.each_with_index do | student, index|%>
        <tr onclick="showStudentInfo(<%= student.id %>)">
          <td><%= index + 1 %></td>
          <td><%= student.student_id_number %></td>
          <% if student.student_profile %>
            <td><%= student.student_profile.name %></td>
            <td><%= student.student_profile.date_of_birth %></td>
            <td><%= student.student_profile.class_name %></td>
            <td><%= student.student_profile.address %></td>
          <% else %>
            <td>Nguyen Van A</td>
            <td>01/01/2020</td>
            <td>K62J</td>
            <td>Ha Noi, Viet Nam</td>
          <% end %>
          <td><%= student.check_in_date %></td>
          <td>
            <a class="ui teal tag label teal_label" style="width: 5.7rem">Active</a>
          </td>
        </tr>
        <div class="ui modal" id= "student_info_<%= student.id %>">
          <i class="close icon"></i>
          <div class="header">
            Student profiles
          </div>
          <div class="image content">
            <div class="ui grid">
              <div class="five wide column">
                <div class="" style="width: 15rem; margin: 0 auto;">
                  <img src="/assets/ava.jpg" style="width: 15rem; height: 15rem; margin: 0 auto;">
                  <div class="sub-info ui grid" style="padding-top: 1rem">
                    <div class="two wide column" style="padding-bottom: 0!important">
                      <i class="icon address card outline"></i>
                    </div>
                    <div class="fourteen wide column" style="padding-bottom: 0!important">
                      <%= student.student_id_number %>
                    </div>
                    <div class="two wide column" style="padding-bottom: 0!important">
                      <i class="icon check square outline"></i>
                    </div>
                    <% if student.student_profile %>
                      <div class="fourteen wide column" style="padding-bottom: 0!important">
                        <%= student.student_profile.class_name %>
                      </div>
                      <div class="two wide column">
                        <i class="icon envelope outline"></i>
                      </div>
                      <div class="fourteen wide column">
                        <%= student.student_profile.email %>
                      </div>
                    <% else %>
                      <div class="fourteen wide column" style="padding-bottom: 0!important">
                        KKK
                      </div>
                      <div class="two wide column">
                        <i class="icon envelope outline"></i>
                      </div>
                      <div class="fourteen wide column">
                        email@gmail.com
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
              <div class="description eleven wide column">
                <% if student.student_profile %>
                <div class="ui header" style="margin-bottom: 2rem;"><%= student.student_profile.name %></div>
                <div class="student-info ui grid">
                  <div class="three wide column"><b>Ngay sinh:</b></div>
                  <div class="thirteen wide column"><%= student.student_profile.date_of_birth %></div>
                  <div class="three wide column"><b>Gioi tinh:</b></div>
                  <div class="thirteen wide column"><%= student.student_profile.gender %></div>
                  <div class="three wide column"><b>Que quan:</b></div>
                  <div class="thirteen wide column"><%= student.student_profile.address %></div>
                  <div class="three wide column"><b>SDT:</b></div>
                  <div class="thirteen wide column"><%= student.student_profile.phone_number %></div>
                  <div class="three wide column"><b>So CMND:</b></div>
                  <div class="thirteen wide column"><%= student.student_profile.identity_card_number %></div>
                <% else %>
                  <div class="ui header" style="margin-bottom: 2rem;">Nguyen Van A</div>
                  <div class="student-info ui grid">
                  <div class="three wide column"><b>Ngay sinh:</b></div>
                  <div class="thirteen wide column">01/01/2021</div>
                  <div class="three wide column"><b>Gioi tinh:</b></div>
                  <div class="thirteen wide column">nam</div>
                  <div class="three wide column"><b>Que quan:</b></div>
                  <div class="thirteen wide column">Ha Noi, Viet Nam</div>
                  <div class="three wide column"><b>SDT:</b></div>
                  <div class="thirteen wide column">19001234</div>
                  <div class="three wide column"><b>So CMND:</b></div>
                  <div class="thirteen wide column">123456789</div>
                <% end %>
                  <div class="three wide column"><b>Ngay dang ky:</b></div>
                  <div class="thirteen wide column">01/01/2021</div>
                  <div class="three wide column"><b>Ngay vao:</b></div>
                  <div class="thirteen wide column">01/01/2021</div>
                  <div class="three wide column"><b>Thoi gian gia han:</b></div>
                  <div class="thirteen wide column">01/01/2021</div>
                  <div class="three wide column"><b>Trang thai:</b></div>
                  <div class="thirteen wide column">Active</div>
                </div>
              </div>
            </div>
          </div>
          <div class="actions" style="padding: 0.7rem 1rem;">
            <div class="ui black deny button">
              Cancel
            </div>
            <a href="/manager/student-management/<%= student.id%>/edit" class="ui positive right labeled icon button">
              Edit
              <i class="arrow right icon"></i>
            </a>
          </div>
        </div>

      <% end %>
    </tbody>
  </table>
</div>

<div class="ui mini modal add_student">
  <div class="header">
    Create new student
  </div>
  <div class="content">
    <div class="description">
      <%# <label style="display: inline-block">Ho va ten</label> %>
      <form id="add-form">
        <div class="ui left corner labeled input" style="display: block; width: 85%; margin: 1rem auto;">
          <input type="text" placeholder="Ho va ten..." style="display:block; width: 100%" name="name">
          <div class="ui left corner label">
            <i class="asterisk icon"></i>
          </div>
        </div>
        <div class="ui left corner labeled input" style="display: block; width: 85%; margin: 1rem auto;">
          <input type="text" placeholder="MSSV..." style="display:block; width: 100%" name="student_id_number">
          <div class="ui left corner label">
            <i class="asterisk icon"></i>
          </div>
        </div>
        <div class="ui left corner labeled input" style="display: block; width: 85%; margin: 1rem auto;" >
          <input type="text" placeholder="MSSV..." style="display:block; width: 100%" name="student_id_number_confirm">
          <div class="ui left corner label">
            <i class="asterisk icon"></i>
          </div>
        </div>
      </form>
    </div>   
  </div>
  <div class="actions">
    <button class="ui cancel button">
      Cancel
    </button>
    <button class="ui primary approve button" onclick="addSubmit(event)">Add</button>
  </div>
</div>

<script src="https://cdn.ckeditor.com/4.13.0/standard/ckeditor.js"></script>
<script>
    CKEDITOR.replace( 'editor' );
</script>
<script>
  function showStudentInfo(student_id) {
    $(`#student_info_${student_id}`).modal('show');
  }
  function addStudent() {
    $('.ui.mini.modal.add_student').modal('show');
  }

  // $('.coupled.modal')
  //   .modal({
  //     allowMultiple: false
  //   })
  // ;
  // attach events to buttons
  $('.second.modal')
    .modal('attach events', '.first.modal .button.proceed')
  ;
  function addSubmit(e) {
    let addForm = document.getElementById('add-form');
    let formData = new FormData(addForm);
    console.log("abc")
    e.preventDefault();

    $.ajax({
      type: "POST",
      url: "/manager/student-management/create",
      processData: false,
      contentType: false,
      cache: false,
      mimeType: 'multipart/form-data',
      data: formData,
      success: function(result){
        console.log(result)
        let result_html = document.createElement('tr')
        result_html.innerHTML = result
        document.querySelector('#student_list').append(result_html)
      },
      error: function (error) {
        console.log(error)
        console.log("fails")
      }

    })

  }



  // CKEDITOR.replace('content',{ toolbar :[ ['Subscript','Superscript'] ], height: '35px', width: '100%' });



</script>