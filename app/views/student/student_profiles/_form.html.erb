<div class="student_profile_form">
  <div class= "container">
    <div class="profile_content">
      <div class="ui grid">
        <div class="five wide column">
          <div class="left_column">
            <div class="ava">
              <div class="ava_image">
              <% if @student.student_profile.avatar.url != nil %>
                <img class="ui medium circular image" id="preview_image_card" src="<%= @student.student_profile.avatar.url %>" style="border-radius: 50%; height: 10.4rem; width: 10.4rem">
              <% else %>
                <img class="ui medium circular image" id="preview_image_card" src="/assets/profile.png" style="border-radius: 50%; height: 10.4rem; width: 10.4rem">
              <% end %>
              </div>
              <div class="ava_icon">
                <button id="insert_image_button" class="ui icon button" style="padding: 1px 11px">
                  <input style="	width: 0.1px;	height: 0.1px;	opacity: 0;	overflow: hidden;	position: absolute;	z-index: -1;" type="file" class="inputfile" id="embedpollfileinput1" onchange="generatePreviewImage(this)" style="width: 100%; height: 100%" multiple="true" accept="image/png, image/jpeg" name="images_input" />
                  <label id="lable_image" for="embedpollfileinput1" class="ui button" style="margin: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 0">
                    <i class="edit outline icon" style="margin: 0"></i>
                  </label>
                </button>
                <button class="ui icon button" onclick="resetAva()">
                  <i class="trash alternate outline icon"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="eleven wide column">
          <div class="right_column">
            <h3 class="ui dividing header">
              Student Information
            </h3>
             <%= form_for @student, html: {class: 'ui form', id: "profile_form"}, url: {controller: "student_profiles", action: "update"}  do |student|%>
              <div class="two fields">
                <div class="required field field_line">
                  <%= student.label :student_id_number %>
                  <%= student.text_field :student_id_number, class: "input", required: true, placeholder: "Student it number", disabled: true %>
                </div>
                <div class="required field field_line">
                  <label>Room</label>
                  <div class="ui input" >
                    <% if @student.room.id != 1 %>
                      <input value="<%= @student.room.room_name %>" disabled/>
                    <% else %>
                      <input value="PENDING" disabled/>
                    <% end %>            
                  </div>
                </div>
              </div>
              <%= student.fields_for :student_profile do |f| %>
                <div class="required field field_line">
                  <%= f.label :full_name %>
                  <input value="<%= @student.name %>" disabled/>
                </div>
                <div class="field field_line">
                  <div class="two fields">
                    <div class="field">
                      <label>Class name</label>
                      <%= f.text_field :class_name, class: "input", placeholder: "Clas name" %>
                    </div>
                    <div class="field">
                      <label>Email</label>
                      <%= f.text_field :email, class: "input", placeholder: "Email" %>
                    </div>
                  </div>
                </div>
                <div class="fields field_line">
                  <div class="eight wide field">
                    <label>Identity Card Number</label>
                    <%= f.text_field :identity_card_number, class: "input", maxlength: "16", placeholder: "Identity card number" %>
                  </div>
                  <div class="eight wide field">
                    <label>Date of Birth</label>
                    <%= f.date_field :date_of_birth, class: "input date", data: {provide: "datepicker"} %>
                  </div>
                </div>
                <div class="field field_line">
                  <label>Address</label>
                  <%= f.text_field :address, class: "input", placeholder: "Address" %>
                </div>
                <div class="field field_line">
                  <div class="two fields">
                    <div class="field">
                      <label>Phone number</label>
                      <%= f.text_field :phone_number, class: "input", placeholder: "Phone number" %>
                    </div>
                    <div class="field">    
                      <%= f.label :gender %>
                      <div class="options" style="height: 60%; margin-top: 0.8rem">
                        <span style="margin-right: 0.6rem">
                          <span class="option" style="margin-right: 0.3rem">Male</span><%= f.radio_button :gender, 'MALE' %>
                        </span>
                        <span>
                          <span class="option" style="margin-right: 0.3rem">Female</span><%= f.radio_button :gender, 'FEMALE' %>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
              <div class="ui dividing header">
                Confirmation
              </div>
              <div class="ui checkbox">
                <input type="checkbox" name="example">
                <label>You are sure that the information above is correct</label>
              </div>
              <div class="field" style="float: right; margin-top: 4em">
                <div class="ui blue submit button" onclick="updateSubmit()">Submit</div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function resetAva(){
    console.log("reste")
    $.ajax({
      type: "PUT",
      url: "/student/student-profile/reset-ava",
      success: function(result){
        document.getElementById("preview_image_card").src = "/assets/profile.png"
        toastr.success(result.message)
      },
      error: function(error){
          toastr.success(error.message)
      }
    })
  }

  function generatePreviewImage(image){
    document.getElementById("preview_image_card").src = URL.createObjectURL(image.files[0])
    let form = new FormData()
    form.set('avatar', image.files[0])
    $.ajax({
      type: "POST",
      url: "/student/student-profile/update-avatar",
      processData: false,
      contentType: false,
      cache: false,
      mimeType: 'multipart/form-data',
      data: form,
      success: function(result){
        toastr.success(JSON.parse(result).message)
      },
      error: function (error){
        toastr.success("Update avatar failed!")
      }
    })
  }

  function updateSubmit() {
    let myForm = document.getElementById('profile_form');
    let formData = new FormData(myForm);
    $.ajax({
      type: "PUT",
      url: "/student/student-profile/update",
      processData: false,
      contentType: false,
      cache: false,
      mimeType: 'multipart/form-data',
      data: formData,
      success: function(result){
        console.log(result)
        toastr.success(JSON.parse(result).message)
      },
      error: function (error) {
        toastr.error(JSON.parse(error).responseJSON.message)
      }
    })
  }
</script>
<style>
#insert_image_button:hover #lable_image{
  background-color: #cacbcd;
}

</style>